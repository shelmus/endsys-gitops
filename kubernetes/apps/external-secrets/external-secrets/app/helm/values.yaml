---
# External Secrets Operator Helm Values
# Reference: https://external-secrets.io/latest/

# Core ESO configuration
installCRDs: true
replicaCount: 1

# Bitwarden SDK Server configuration
# This sidecar/subchart is required for Bitwarden Secrets Manager integration
# The SDK server wraps the Bitwarden Rust SDK and provides a REST API for ESO
bitwarden-sdk-server:
  enabled: true
  # Use the official ESO bitwarden-sdk-server image
  # Pin to a specific version for stability
  image:
    repository: ghcr.io/external-secrets/bitwarden-sdk-server
    tag: v0.5.0
    pullPolicy: IfNotPresent
    # TLS configuration - SDK server requires HTTPS
    # Certificates are generated by cert-manager (see certificate.yaml)
    # Note: TLS config must be under image.tls, not bitwarden-sdk-server.tls
    tls:
      enabled: true
      volumeMounts:
        - mountPath: "/certs"
          name: "bitwarden-tls-certs"
      volumes:
        - name: "bitwarden-tls-certs"
          secret:
            secretName: "bitwarden-sdk-tls-certs"
            items:
              - key: "tls.crt"
                path: "cert.pem"
              - key: "tls.key"
                path: "key.pem"
              - key: "ca.crt"
                path: "ca.pem"
  # Resource limits
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

# Cert controller for webhook certificates
certController:
  create: true
  replicaCount: 1
  resources:
    requests:
      cpu: 10m
      memory: 64Mi
    limits:
      cpu: 100m
      memory: 128Mi

# Webhook configuration
webhook:
  create: true
  replicaCount: 1
  resources:
    requests:
      cpu: 10m
      memory: 64Mi
    limits:
      cpu: 100m
      memory: 128Mi

# Main controller resources
resources:
  requests:
    cpu: 10m
    memory: 64Mi
  limits:
    cpu: 100m
    memory: 128Mi

# Prometheus ServiceMonitor
serviceMonitor:
  enabled: true
  interval: 30s

# Pod security context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 65534
  runAsGroup: 65534
  fsGroup: 65534

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true

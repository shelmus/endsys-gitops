---
# Example ExternalSecret using Bitwarden Secrets Manager
# This file is for reference only - do not include in kustomization.yaml
#
# Copy this template to your application's directory and customize it
# for your specific secret requirements.
#
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: my-app-secrets
  namespace: my-app  # Change to your application's namespace
  labels:
    app.kubernetes.io/name: my-app
    app.kubernetes.io/component: secrets
spec:
  # How often to sync secrets from Bitwarden
  refreshInterval: 1h

  # Reference the ClusterSecretStore
  secretStoreRef:
    kind: ClusterSecretStore
    name: bitwarden-secretsmanager

  # Target Kubernetes secret to create/update
  target:
    name: my-app-secrets
    creationPolicy: Owner
    deletionPolicy: Retain

  # Map Bitwarden secrets to Kubernetes secret keys
  data:
    # Option 1: Reference secret by UUID (recommended for stability)
    - secretKey: database-password
      remoteRef:
        key: "339062b8-a5a1-4303-bf1d-b1920146a622"  # Bitwarden secret UUID

    # Option 2: Reference secret by name
    - secretKey: api-key
      remoteRef:
        key: "my-api-key-secret-name"

    # Option 3: Extract specific property from a secret
    - secretKey: smtp-password
      remoteRef:
        key: "smtp-credentials"
        property: password  # If the secret has multiple fields

---
# Alternative: Sync all secrets from a project using dataFrom
# Note: When using dataFrom, keys are mapped by UUID to avoid conflicts
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: my-app-all-secrets
  namespace: my-app
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: bitwarden-secretsmanager
  target:
    name: my-app-all-secrets
    creationPolicy: Owner
  # Fetch all secrets from the configured project
  dataFrom:
    - find:
        # Match all secrets (or use regex for filtering)
        name:
          regexp: ".*"

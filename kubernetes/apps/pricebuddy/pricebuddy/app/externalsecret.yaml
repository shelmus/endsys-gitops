---
# ExternalSecret for PriceBuddy Application Secrets
# Contains database credentials and admin user credentials
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: pricebuddy-secrets
  labels:
    app.kubernetes.io/name: pricebuddy
    app.kubernetes.io/instance: pricebuddy
    app.kubernetes.io/component: secrets
    app.kubernetes.io/part-of: pricebuddy
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: bitwarden-secrets
  target:
    name: pricebuddy-secrets
    creationPolicy: Owner
    template:
      type: Opaque
      data:
        # Database credentials
        db-username: "{{ .db_username }}"
        db-password: "{{ .db_password }}"
        db-root-password: "{{ .db_root_password }}"
        # Admin user credentials (for initial seeding)
        admin-name: "{{ .admin_name }}"
        admin-email: "{{ .admin_email }}"
        admin-password: "{{ .admin_password }}"
  data:
    # Replace with your actual Bitwarden secret IDs
    - secretKey: db_username
      remoteRef:
        key: pricebuddy-db-username
    - secretKey: db_password
      remoteRef:
        key: pricebuddy-db-password
    - secretKey: db_root_password
      remoteRef:
        key: pricebuddy-db-root-password
    - secretKey: admin_name
      remoteRef:
        key: pricebuddy-admin-name
    - secretKey: admin_email
      remoteRef:
        key: pricebuddy-admin-email
    - secretKey: admin_password
      remoteRef:
        key: pricebuddy-admin-password
